var H=Object.defineProperty;var q=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var N=(t,i,a)=>i in t?H(t,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[i]=a,R=(t,i)=>{for(var a in i||(i={}))L.call(i,a)&&N(t,a,i[a]);if(q)for(var a of q(i))G.call(i,a)&&N(t,a,i[a]);return t};var D=(t,i,a)=>new Promise((y,d)=>{var n=u=>{try{p(a.next(u))}catch(_){d(_)}},c=u=>{try{p(a.throw(u))}catch(_){d(_)}},p=u=>u.done?y(u.value):Promise.resolve(u.value).then(n,c);p((a=a.apply(t,i)).next())});import{i as J,r as j,N as K,c as I,w as E,e as P,f as v,a3 as w,j as x,x as s,z as g,k as h,t as f,q as r,F as O,H as S,v as $,l as b,n as A}from"./frappe-ui-Cee7Yz-T.js";import Q from"./FormField-CAm_QixC.js";import{_ as W}from"./index-67wm3rxu.js";import X from"./CustomIonModal-D0aHGeN-.js";import{f as k}from"./formatters-Ephtd2vf.js";import"./Link-PW9qmcCL.js";const Y={class:"flex flex-row justify-between items-center pt-4"},Z={class:"text-base font-semibold text-gray-800"},ee={class:"flex flex-row gap-3 items-center"},te={class:"text-base font-semibold text-gray-800"},ae={key:0,class:"flex flex-col bg-white mt-5 rounded border overflow-auto"},se=["onClick"],le={class:"flex flex-col w-full justify-center gap-2.5"},ne={class:"flex flex-row items-center justify-between"},oe={class:"flex flex-row items-start gap-3 grow"},ie={class:"flex flex-col items-start gap-1.5"},re={class:"text-base font-normal text-gray-800"},de={class:"text-xs font-normal text-gray-500"},ce={class:"whitespace-nowrap"},ue={class:"flex flex-row justify-end items-center gap-2"},xe={class:"text-gray-700 font-normal rounded text-base"},me={class:"bg-white w-full flex flex-col items-center justify-center pb-5"},fe={class:"w-full pt-8 pb-5 border-b text-center"},pe={class:"text-gray-900 font-bold text-xl"},ve={class:"w-full flex flex-col items-center justify-center gap-5 p-4"},ye={class:"flex flex-col w-full space-y-4"},_e={key:0,class:"flex w-full flex-row items-center justify-between gap-3"},je={__name:"ExpenseTaxesTable",props:{expenseClaim:{type:Object,required:!0},currency:{type:String,required:!0},isReadOnly:{type:Boolean,default:!1}},emits:["add-expense-tax","update-expense-tax","delete-expense-tax"],setup(t,{emit:i}){const a=t,y=i,d=J("$translate"),n=j({}),c=j(null),p=j(!1),u=(o,l)=>D(this,null,function*(){o&&(n.value=R({},o),c.value=l),p.value=!0}),_=()=>{y("delete-expense-tax",c.value),C()},U=()=>{c.value===null?y("add-expense-tax",n.value):y("update-expense-tax",n.value,c.value),C()};function C(){p.value=!1,n.value={},c.value=null}const T=K({url:"hrms.api.get_doctype_fields",params:{doctype:"Expense Taxes and Charges"},transform(o){const l=["description_sb"];return o.map(m=>(m.fieldname==="account_head"&&(m.linkFilters={company:a.expenseClaim.company,account_type:["in",["Tax","Chargeable","Income Account","Expenses Included In Valuation"]]}),m)).filter(m=>!l.includes(m.fieldname))}});T.reload();const M=I(()=>a.isReadOnly?d("Expense Tax"):c.value===null?d("New Expense Tax"):d("Edit Expense Tax")),z=I(()=>{var o;return(o=T.data)==null?void 0:o.some(l=>{if(l.reqd&&!n.value[l.fieldname])return!0})});E(()=>n.value.account_head,o=>{n.value.description=o==null?void 0:o.split(" - ").slice(0,-1).join(" - ")}),E(()=>n.value.rate,(o,l)=>{c.value&&o&&!l||(n.value.tax_amount=parseFloat(a.expenseClaim.total_sanctioned_amount)*(parseFloat(o)/100),B())}),E(()=>n.value.tax_amount,o=>{B()});function B(){n.value.total=parseFloat(a.expenseClaim.total_sanctioned_amount)+parseFloat(n.value.tax_amount)}return(o,l)=>{var V;const m=P("Button");return t.expenseClaim.expenses?(x(),v(O,{key:0},[s("div",Y,[s("h2",Z,f(r(d)("Taxes & Charges")),1),s("div",ee,[s("span",te,f(r(k)(t.expenseClaim.total_taxes_and_charges,t.currency)),1),t.isReadOnly?w("",!0):(x(),g(m,{key:0,id:"add-taxes-modal",class:"text-sm",icon:"plus",variant:"subtle",onClick:l[0]||(l[0]=e=>u())}))])]),(V=t.expenseClaim.taxes)!=null&&V.length?(x(),v("div",ae,[(x(!0),v(O,null,S(t.expenseClaim.taxes,(e,F)=>(x(),v("div",{class:"flex flex-row p-3.5 items-center justify-between border-b cursor-pointer",key:e.name,onClick:he=>u(e,F)},[s("div",le,[s("div",ne,[s("div",oe,[s("div",ie,[s("div",re,f(e.account_head),1),s("div",de,[s("span",null," Rate: "+f(r(k)(e.rate,t.currency)),1),l[4]||(l[4]=s("span",{class:"whitespace-pre"}," Â· ",-1)),s("span",ce," Amount: "+f(r(k)(e.tax_amount,t.currency)),1)])])]),s("div",ue,[s("span",xe,f(r(k)(e.total,t.currency)),1),h(r($),{name:"chevron-right",class:"h-5 w-5 text-gray-500"})])])])],8,se))),128))])):(x(),g(W,{key:1,message:r(d)("No taxes added"),isTableField:!0},null,8,["message"])),h(X,{isOpen:p.value,onDidDismiss:l[3]||(l[3]=e=>C())},{actionSheet:b(()=>[s("div",me,[s("div",fe,[s("span",pe,f(M.value),1)]),s("div",ve,[s("div",ye,[(x(!0),v(O,null,S(r(T).data,e=>(x(),g(Q,{key:e.fieldname,class:"w-full",label:r(d)(e.label,null,"Expense Claim Detail"),fieldtype:e.fieldtype,fieldname:e.fieldname,options:e.options,linkFilters:e.linkFilters,hidden:e.hidden,reqd:e.reqd,readOnly:e.read_only||t.isReadOnly,default:e.default,modelValue:n.value[e.fieldname],"onUpdate:modelValue":F=>n.value[e.fieldname]=F},null,8,["label","fieldtype","fieldname","options","linkFilters","hidden","reqd","readOnly","default","modelValue","onUpdate:modelValue"]))),128))]),t.isReadOnly?w("",!0):(x(),v("div",_e,[c.value!==null?(x(),g(m,{key:0,class:"border-red-600 text-red-600 py-5 text-sm",variant:"outline",theme:"red",onClick:l[1]||(l[1]=e=>_())},{prefix:b(()=>[h(r($),{name:"trash",class:"w-4"})]),default:b(()=>[A(" "+f(r(d)("Delete")),1)]),_:1})):w("",!0),h(m,{variant:"solid",class:"w-full py-5 text-sm disabled:bg-gray-700 disabled:text-white",onClick:l[2]||(l[2]=e=>U()),disabled:z.value},{prefix:b(()=>[h(r($),{name:c.value===null?"plus":"check",class:"w-4"},null,8,["name"])]),default:b(()=>[A(" "+f(c.value===null?r(d)("Add Tax"):r(d)("Update Tax")),1)]),_:1},8,["disabled"])]))])])]),_:1},8,["isOpen"])],64)):w("",!0)}}};export{je as default};
//# sourceMappingURL=ExpenseTaxesTable-C8Cfq4KL.js.map
