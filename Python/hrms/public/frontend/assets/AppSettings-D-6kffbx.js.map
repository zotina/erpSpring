{"version":3,"file":"AppSettings-D-6kffbx.js","sources":["../../../../frontend/src/views/AppSettings.vue"],"sourcesContent":["<template>\n\t<ion-page>\n\t\t<ion-content class=\"ion-padding\">\n\t\t\t<div class=\"flex flex-col h-screen w-screen\">\n\t\t\t\t<div class=\"w-full sm:w-96\">\n\t\t\t\t\t<header\n\t\t\t\t\t\tclass=\"flex flex-row bg-white shadow-sm py-4 px-3 items-center justify-between border-b sticky top-0 z-10\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"flex flex-row items-center\">\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\tclass=\"!pl-0 hover:bg-white\"\n\t\t\t\t\t\t\t\t@click=\"router.back()\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<FeatherIcon name=\"chevron-left\" class=\"h-5 w-5\" />\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t<h2 class=\"text-xl font-semibold text-gray-900\">{{ __(\"Settings\") }} </h2>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</header>\n\n\t\t\t\t\t<div class=\"flex flex-col gap-5 my-4 w-full p-4\">\n\t\t\t\t\t\t<div class=\"flex flex-col bg-white rounded\">\n\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\tsize=\"md\"\n\t\t\t\t\t\t\t\t:label=\"__('Enable Push Notifications')\"\n\t\t\t\t\t\t\t\t:class=\"description ? 'p-2' : ''\"\n\t\t\t\t\t\t\t\t:model-value=\"pushNotificationState\"\n\t\t\t\t\t\t\t\t:disabled=\"disablePushSetting\"\n\t\t\t\t\t\t\t\t:description=\"description\"\n\t\t\t\t\t\t\t\t@update:model-value=\"togglePushNotifications\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<!-- Loading Indicator -->\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if=\"isLoading\"\n\t\t\t\t\t\t\tclass=\"flex -mt-2 items-center justify-center gap-2\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<LoadingIndicator class=\"w-3 h-3 text-gray-800\" />\n\t\t\t\t\t\t\t<span class=\"text-gray-900 text-sm\">\n\t\t\t\t\t\t\t\t{{ pushNotificationState ? __(\"Disabling Push Notifications...\") : __(\"Enabling Push Notifications...\") }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</ion-content>\n\t</ion-page>\n</template>\n\n<script setup>\nimport { IonPage, IonContent } from \"@ionic/vue\"\nimport { useRouter } from \"vue-router\"\nimport { FeatherIcon, Switch, toast, LoadingIndicator } from \"frappe-ui\"\n\nimport { computed, inject, ref } from \"vue\"\n\nimport { arePushNotificationsEnabled } from \"@/data/notifications\"\n\nconst __ = inject(\"$translate\")\nconst router = useRouter()\nconst pushNotificationState = ref(\n\twindow.frappePushNotification?.isNotificationEnabled()\n)\nconst isLoading = ref(false)\n\nconst disablePushSetting = computed(() => {\n\treturn (\n\t\t!(\n\t\t\twindow.frappe?.boot.push_relay_server_url &&\n\t\t\tarePushNotificationsEnabled.data\n\t\t) || isLoading.value\n\t)\n})\n\nconst description = computed(() => {\n\treturn !(\n\t\twindow.frappe?.boot.push_relay_server_url &&\n\t\tarePushNotificationsEnabled.data\n\t)\n\t\t? __(\"Push notifications have been disabled on your site\")\n\t\t: \"\"\n})\n\nconst togglePushNotifications = (newValue) => {\n\tif (newValue) {\n\t\tenablePushNotifications()\n\t} else {\n\t\tisLoading.value = true\n\t\twindow.frappePushNotification\n\t\t\t.disableNotification()\n\t\t\t.then((data) => {\n\t\t\t\tpushNotificationState.value = false // Disable the switch\n\t\t\t\t// TODO: add commonfied toast util for success and error messages\n\t\t\t\ttoast({\n\t\t\t\t\ttitle: __(\"Success\"),\n\t\t\t\t\ttext: __(\"Push notifications disabled\"),\n\t\t\t\t\ticon: \"check-circle\",\n\t\t\t\t\tposition: \"bottom-center\",\n\t\t\t\t\ticonClasses: \"text-green-500\",\n\t\t\t\t})\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\ttoast({\n\t\t\t\t\ttitle: __(\"Error\"),\n\t\t\t\t\ttext: __(error.message),\n\t\t\t\t\ticon: \"alert-circle\",\n\t\t\t\t\tposition: \"bottom-center\",\n\t\t\t\t\ticonClasses: \"text-red-500\",\n\t\t\t\t})\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tisLoading.value = false\n\t\t\t})\n\t}\n}\n\nconst enablePushNotifications = () => {\n\tisLoading.value = true\n\n\twindow.frappePushNotification\n\t\t.enableNotification()\n\t\t.then((data) => {\n\t\t\tif (data.permission_granted) {\n\t\t\t\tpushNotificationState.value = true\n\t\t\t} else {\n\t\t\t\ttoast({\n\t\t\t\t\ttitle: __(\"Error\"),\n\t\t\t\t\ttext: __(\"Push Notification permission denied\"),\n\t\t\t\t\ticon: \"alert-circle\",\n\t\t\t\t\tposition: \"bottom-center\",\n\t\t\t\t\ticonClasses: \"text-red-500\",\n\t\t\t\t})\n\t\t\t\tpushNotificationState.value = false\n\t\t\t}\n\t\t})\n\t\t.catch((error) => {\n\t\t\ttoast({\n\t\t\t\ttitle: __(\"Error\"),\n\t\t\t\ttext: __(error.message),\n\t\t\t\ticon: \"alert-circle\",\n\t\t\t\tposition: \"bottom-center\",\n\t\t\t\ticonClasses: \"text-red-500\",\n\t\t\t})\n\t\t\tpushNotificationState.value = false\n\t\t})\n\t\t.finally(() => {\n\t\t\tisLoading.value = false\n\t\t})\n}\n</script>\n"],"names":["__","inject","router","useRouter","pushNotificationState","ref","_a","isLoading","disablePushSetting","computed","arePushNotificationsEnabled","description","togglePushNotifications","newValue","enablePushNotifications","data","toast","error"],"mappings":"owBA0DA,MAAMA,EAAKC,EAAO,YAAY,EACxBC,EAASC,EAAS,EAClBC,EAAwBC,GAC7BC,EAAA,OAAO,yBAAP,YAAAA,EAA+B,uBAChC,EACMC,EAAYF,EAAI,EAAK,EAErBG,EAAqBC,EAAS,IAAM,OACzC,MACC,GACCH,EAAA,OAAO,SAAP,MAAAA,EAAe,KAAK,uBACpBI,EAA4B,OACxBH,EAAU,KAEjB,CAAC,EAEKI,EAAcF,EAAS,IAAM,OAClC,OACCH,EAAA,OAAO,SAAP,MAAAA,EAAe,KAAK,uBACpBI,EAA4B,KAG1B,GADAV,EAAG,oDAAoD,CAE3D,CAAC,EAEKY,EAA2BC,GAAa,CACzCA,EACHC,EAAuB,GAEvBP,EAAU,MAAQ,GAClB,OAAO,uBACL,oBAAmB,EACnB,KAAMQ,GAAS,CACfX,EAAsB,MAAQ,GAE9BY,EAAM,CACL,MAAOhB,EAAG,SAAS,EACnB,KAAMA,EAAG,6BAA6B,EACtC,KAAM,eACN,SAAU,gBACV,YAAa,gBACb,CAAA,CACD,CAAA,EACA,MAAOiB,GAAU,CACjBD,EAAM,CACL,MAAOhB,EAAG,OAAO,EACjB,KAAMA,EAAGiB,EAAM,OAAO,EACtB,KAAM,eACN,SAAU,gBACV,YAAa,cACb,CAAA,CACD,CAAA,EACA,QAAQ,IAAM,CACdV,EAAU,MAAQ,EAClB,CAAA,EAEJ,EAEMO,EAA0B,IAAM,CACrCP,EAAU,MAAQ,GAElB,OAAO,uBACL,mBAAkB,EAClB,KAAMQ,GAAS,CACXA,EAAK,mBACRX,EAAsB,MAAQ,IAE9BY,EAAM,CACL,MAAOhB,EAAG,OAAO,EACjB,KAAMA,EAAG,qCAAqC,EAC9C,KAAM,eACN,SAAU,gBACV,YAAa,cACb,CAAA,EACDI,EAAsB,MAAQ,GAE/B,CAAA,EACA,MAAOa,GAAU,CACjBD,EAAM,CACL,MAAOhB,EAAG,OAAO,EACjB,KAAMA,EAAGiB,EAAM,OAAO,EACtB,KAAM,eACN,SAAU,gBACV,YAAa,cACb,CAAA,EACDb,EAAsB,MAAQ,EAC9B,CAAA,EACA,QAAQ,IAAM,CACdG,EAAU,MAAQ,EAClB,CAAA,CACH"}