{"version":3,"file":"ShiftRequestForm-CRyNQQeq.js","sources":["../../../../frontend/src/views/attendance/ShiftRequestForm.vue"],"sourcesContent":["<template>\n\t<ion-page>\n\t\t<ion-content :fullscreen=\"true\">\n\t\t\t<FormView\n\t\t\t\tv-if=\"formFields.data\"\n\t\t\t\tdoctype=\"Shift Request\"\n\t\t\t\tv-model=\"shiftRequest\"\n\t\t\t\t:isSubmittable=\"true\"\n\t\t\t\t:fields=\"formFields.data\"\n\t\t\t\t:id=\"props.id\"\n\t\t\t\t@validateForm=\"validateForm\"\n\t\t\t/>\n\t\t</ion-content>\n\t</ion-page>\n</template>\n\n<script setup>\nimport { IonPage, IonContent } from \"@ionic/vue\"\nimport { createResource } from \"frappe-ui\"\nimport { ref, watch, inject } from \"vue\"\n\nimport FormView from \"@/components/FormView.vue\"\n\nconst employee = inject(\"$employee\")\n\nconst props = defineProps({\n\tid: {\n\t\ttype: String,\n\t\trequired: false,\n\t},\n})\n\n// reactive object to store form data\nconst shiftRequest = ref({})\n\n// get form fields\nconst formFields = createResource({\n\turl: \"hrms.api.get_doctype_fields\",\n\tparams: { doctype: \"Shift Request\" },\n\tauto: true,\n\ttransform(data) {\n\t\tif (props.id) return data\n\t\treturn data.filter(\n\t\t\t(field) => ![\"employee\", \"employee_name\", \"status\", \"company\"].includes(field.fieldname)\n\t\t)\n\t},\n})\n\ncreateResource({\n\turl: \"hrms.api.get_shift_request_approvers\",\n\tparams: { employee: employee.data.name },\n\tauto: !props.id,\n\tonSuccess(data) {\n\t\tconst approver = formFields.data?.find((field) => field.fieldname === \"approver\")\n\t\tapprover.documentList = data?.map((approver) => ({\n\t\t\tlabel: approver.full_name ? `${approver.name} : ${approver.full_name}` : approver.name,\n\t\t\tvalue: approver.name,\n\t\t}))\n\t\tshiftRequest.value.approver = data[0]?.name\n\t},\n})\n\n// form scripts\nwatch(\n\t() => shiftRequest.value.employee,\n\t(employee_id) => {\n\t\tif (props.id && employee_id !== employee.data.name) {\n\t\t\t// if employee is not the current user, set form as read only\n\t\t\tsetFormReadOnly()\n\t\t}\n\t}\n)\n\nwatch(\n\t() => [shiftRequest.value.from_date, shiftRequest.value.to_date],\n\t([from_date, to_date]) => {\n\t\tvalidateDates(from_date, to_date)\n\t}\n)\n\n// helper functions\nfunction setFormReadOnly() {\n\tif (shiftRequest.value.approver === employee.data.user_id) return\n\tformFields.data.map((field) => (field.read_only = true))\n}\n\nfunction validateDates(from_date, to_date) {\n\tif (!(from_date && to_date)) return\n\n\tconst error_message = from_date > to_date ? __(\"To Date cannot be before From Date\") : \"\"\n\n\tconst from_date_field = formFields.data.find((field) => field.fieldname === \"from_date\")\n\tfrom_date_field.error_message = error_message\n}\n\nfunction validateForm() {\n\tshiftRequest.value.employee = employee.data.name\n}\n</script>\n"],"names":["employee","inject","props","__props","shiftRequest","ref","formFields","createResource","data","field","approver","_a","_b","watch","employee_id","setFormReadOnly","from_date","to_date","validateDates","error_message","from_date_field","validateForm"],"mappings":"obAuBA,MAAMA,EAAWC,EAAO,WAAW,EAE7BC,EAAQC,EAQRC,EAAeC,EAAI,CAAE,CAAA,EAGrBC,EAAaC,EAAe,CACjC,IAAK,8BACL,OAAQ,CAAE,QAAS,eAAiB,EACpC,KAAM,GACN,UAAUC,EAAM,CACf,OAAIN,EAAM,GAAWM,EACdA,EAAK,OACVC,GAAU,CAAC,CAAC,WAAY,gBAAiB,SAAU,SAAS,EAAE,SAASA,EAAM,SAAS,CAC1F,CACE,CACF,CAAC,EAEDF,EAAe,CACd,IAAK,uCACL,OAAQ,CAAE,SAAUP,EAAS,KAAK,IAAM,EACxC,KAAM,CAACE,EAAM,GACb,UAAUM,EAAM,SACf,MAAME,GAAWC,EAAAL,EAAW,OAAX,YAAAK,EAAiB,KAAMF,GAAUA,EAAM,YAAc,YACtEC,EAAS,aAAeF,GAAA,YAAAA,EAAM,IAAKE,IAAc,CAChD,MAAOA,EAAS,UAAY,GAAGA,EAAS,IAAI,MAAMA,EAAS,SAAS,GAAKA,EAAS,KAClF,MAAOA,EAAS,IACnB,IACEN,EAAa,MAAM,UAAWQ,EAAAJ,EAAK,CAAC,IAAN,YAAAI,EAAS,IACvC,CACF,CAAC,EAGDC,EACC,IAAMT,EAAa,MAAM,SACxBU,GAAgB,CACZZ,EAAM,IAAMY,IAAgBd,EAAS,KAAK,MAE7Ce,EAAe,CAElB,CACA,EAEAF,EACC,IAAM,CAACT,EAAa,MAAM,UAAWA,EAAa,MAAM,OAAO,EAC/D,CAAC,CAACY,EAAWC,CAAO,IAAM,CACzBC,EAAcF,EAAWC,CAAO,CAClC,CACA,EAGA,SAASF,GAAkB,CACtBX,EAAa,MAAM,WAAaJ,EAAS,KAAK,SAClDM,EAAW,KAAK,IAAKG,GAAWA,EAAM,UAAY,EAAK,CACxD,CAEA,SAASS,EAAcF,EAAWC,EAAS,CAC1C,GAAI,EAAED,GAAaC,GAAU,OAE7B,MAAME,EAAgBH,EAAYC,EAAU,GAAG,oCAAoC,EAAI,GAEjFG,EAAkBd,EAAW,KAAK,KAAMG,GAAUA,EAAM,YAAc,WAAW,EACvFW,EAAgB,cAAgBD,CACjC,CAEA,SAASE,GAAe,CACvBjB,EAAa,MAAM,SAAWJ,EAAS,KAAK,IAC7C"}