var Ne=Object.defineProperty;var we=Object.getOwnPropertySymbols;var ze=Object.prototype.hasOwnProperty,Ie=Object.prototype.propertyIsEnumerable;var he=(i,n,e)=>n in i?Ne(i,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[n]=e,G=(i,n)=>{for(var e in n||(n={}))ze.call(n,e)&&he(i,e,n[e]);if(we)for(var e of we(n))Ie.call(n,e)&&he(i,e,n[e]);return i};var _=(i,n,e)=>new Promise((p,h)=>{var a=w=>{try{f(e.next(w))}catch(D){h(D)}},F=w=>{try{f(e.throw(w))}catch(D){h(D)}},f=w=>w.done?p(w.value):Promise.resolve(w.value).then(a,F);f((e=e.apply(i,n)).next())});import{N as P,ac as R,a9 as Pe,i as We,r as V,c as z,w as be,a1 as je,a8 as He,a as Me,e as Te,f as y,j as d,a3 as j,k as v,x as c,z as I,l as g,q as l,v as Ye,t as m,af as xe,a5 as S,al as Ge,F as O,H as J,I as ke,am as Je,an as Ke,ae as _e,ab as Fe,a7 as Qe,n as k,y as te,ao as Xe}from"./frappe-ui-Cee7Yz-T.js";import Ce from"./FormField-CAm_QixC.js";import Ve from"./FileUploaderView-B-HamLML.js";import{u as Ze,W as et,g as tt}from"./workflow-BVhqibwi.js";import{f as De}from"./formatters-Ephtd2vf.js";import"./Link-PW9qmcCL.js";import"./index-67wm3rxu.js";function lt(){const i=new FileReader;return i.__zone_symbol__originalInstance||i}class Se{constructor(n){this.fileObj=n,this.fileName=n.name}upload(n,e,p){return _(this,null,function*(){return new Promise((h,a)=>_(this,null,function*(){const F=lt(),f=P({url:"hrms.api.upload_base64_file",onSuccess:w=>h(w),onError:w=>{var D;R({title:"Error",text:`File upload failed for ${this.fileName}. ${((D=w.messages)==null?void 0:D[0])||""}`,icon:"alert-circle",position:"bottom-center",iconClasses:"text-red-500"}),a(w)}});F.onload=()=>{console.log("Loaded successfully ✅"),this.fileContents=F.result.toString().split(",")[1],f.submit({content:this.fileContents,dt:n,dn:e,filename:this.fileName,fieldname:p})},F.readAsDataURL(this.fileObj)}))})}delete(){return P({url:"hrms.api.delete_attachment",onSuccess:()=>{console.log("Deleted successfully ✅")},onError:n=>{var e;R({title:"Error",text:`File deletion failed. ${((e=n.messages)==null?void 0:e[0])||""}`,icon:"alert-circle",position:"bottom-center",iconClasses:"text-red-500"})}}).submit({filename:this.fileName})}}const le=(i,n)=>i.some(e=>n.includes(e));function at(i,n){return _(this,null,function*(){var a;const p=yield P({url:"hrms.api.get_doctype_states",params:{doctype:i}}).reload();if((a=Object.keys(p||{}))!=null&&a.length){if((p==null?void 0:p[n])==="yellow")return"orange";if(p!=null&&p[n])return p==null?void 0:p[n]}let h="gray";return n=n.toLowerCase(),le(["open","pending","unpaid","review","medium","not approved"],n)?h="orange":le(["urgent","high","failed","rejected","error"],n)?h="red":le(["closed","finished","converted","completed","complete","confirmed","approved","yes","active","available","success"],n)?h="green":n==="submitted"&&(h="blue"),h})}const ot={key:0,class:"flex flex-col h-full w-full"},st={class:"w-full h-full bg-white sm:w-96 flex flex-col"},nt={class:"flex flex-row bg-white shadow-sm py-4 px-3 items-center sticky top-0 z-[1000]"},rt={key:0,class:"flex flex-row items-center gap-2 overflow-hidden grow"},it={class:"text-xl font-semibold text-gray-900 whitespace-nowrap overflow-hidden text-ellipsis"},dt={key:1,class:"text-2xl font-semibold text-gray-900"},ut={class:"bg-white grow overflow-y-auto"},ct={class:"px-4 sticky top-0 z-[100] bg-white text-sm font-medium text-center text-gray-500 border-b border-gray-200 dark:text-gray-400 dark:border-gray-700"},mt={class:"flex -mb-px overflow-auto hide-scrollbar"},ft={class:"mr-2 whitespace-nowrap"},pt=["onClick"],yt={class:"flex flex-col space-y-4 p-4"},vt={key:0,class:"flex flex-row gap-2 items-center justify-center p-5"},gt={class:"text-gray-900 text-sm"},wt={key:1,class:"flex flex-col space-y-4 p-4"},ht={key:0,class:"flex flex-row gap-2 items-center justify-center p-5"},bt={class:"text-gray-900 text-sm"},xt={key:0,class:"px-4 pt-4 pb-4 standalone:pb-safe-bottom sm:w-96 bg-white sticky bottom-0 w-full drop-shadow-xl z-40 border-t rounded-t-lg"},kt={key:2,class:"px-4 pt-4 pb-4 standalone:pb-safe-bottom sm:w-96 bg-white sticky bottom-0 w-full drop-shadow-xl z-40 border-t rounded-t-lg"},_t={class:"text-xl font-bold"},Ft={class:"font-bold"},Ct={class:"flex flex-row gap-4"},Vt={class:"text-xl font-bold"},Dt={class:"font-bold"},St={class:"flex flex-row gap-4"},Bt={class:"text-xl font-bold"},Et={class:"font-bold"},$t={class:"flex flex-row gap-4"},It={__name:"FormView",props:{doctype:{type:String,required:!0},modelValue:{type:Object,required:!0},isSubmittable:{type:Boolean,required:!1,default:!1},fields:{type:Array,required:!0},id:{type:String,required:!1},tabbedView:{type:Boolean,required:!1,default:!1},tabs:{type:Array,required:!1},showAttachmentView:{type:Boolean,required:!1,default:!1},showFormButton:{type:Boolean,required:!1,default:!0}},emits:["validateForm","update:modelValue"],setup(i,{emit:n}){var fe;const e=i,p=n,h=Pe(),a=We("$translate");let F=V((fe=e.tabs)==null?void 0:fe[0].name),f=V([]),w=V(""),D=V(""),q=V(!1),H=V(!1),C=V(!1),B=V(!1),E=V(!1),M=V(!1),A=V(null);const r=z({get(){return e.modelValue},set(o){p("update:modelValue",o)}}),T=z(()=>{if(!e.id)return"";if(A.value){const o=A.value.getWorkflowStateField();if(o)return r.value[o]}return r.value.status||r.value.approval_status});be(()=>r.value,()=>{e.id&&(ee.value&&!H.value?q.value=!0:H.value&&(H.value=!1))},{deep:!0}),be(()=>T.value,o=>_(this,null,function*(){o&&(w.value=yield at(e.doctype,T.value))}),{immediate:!0});const Be=z(()=>{var U;let o={},t=[],x=0,$=0;return(U=e.tabs)==null||U.forEach(N=>{$=e.fields.findIndex(L=>L.fieldname===N.lastField),t=e.fields.slice(x,$+1),o[N.name]=t,x=$+1}),o}),ae=P({url:"hrms.api.get_attachments",params:{dt:e.doctype,dn:e.id},transform(o){return o.map(t=>t.uploaded=!0)},onSuccess(o){f.value=o}}),oe=o=>{e.id?ne(e.doctype,e.id,[...o.target.files]):f.value.push(...o.target.files)},se=o=>_(this,null,function*(){o.uploaded?(yield new Se(o).delete(),yield ae.reload()):f.value=f.value.filter(t=>t.name!==o.name)});function ne(o,t,x){return _(this,null,function*(){M.value=!0;const $=x.map(U=>new Se(U).upload(o,t,"").then(L=>{L.uploaded=!0,e.id&&f.value.push(L)}));yield Promise.allSettled($),M.value=!1})}const K=je({doctype:e.doctype,insert:{onSuccess(o){return _(this,null,function*(){R({title:a("Success"),text:a("{0} created successfully!",[a(e.doctype)]),icon:"check-circle",position:"bottom-center",iconClasses:"text-green-500"}),yield ne(o.doctype,o.name,f.value),h.replace({name:`${e.doctype.replace(/\s+/g,"")}DetailView`,params:{id:o.name}})})},onError(){R({title:a("Error"),text:a("Error creating {0}",[a(e.doctype)]),icon:"alert-circle",position:"bottom-center",iconClasses:"text-red-500"}),console.log(`Error creating ${e.doctype}`)}}}),b=He({doctype:e.doctype,name:e.id,setValue:{onSuccess(){R({title:a("Success"),text:a("{0} updated successfully!",[a(e.doctype)]),icon:"check-circle",position:"bottom-center",iconClasses:"text-green-500"})},onError(){R({title:a("Error"),text:a("Error updating {0}",[a(e.doctype)]),icon:"alert-circle",position:"bottom-center",iconClasses:"text-red-500"}),console.log(`Error updating ${e.doctype}`)}},delete:{onSuccess(){h.back(),R({title:a("Success"),text:a("{0} deleted successfully!",[a(e.doctype)]),icon:"check-circle",position:"bottom-center",iconClasses:"text-green-500"})},onError(){R({title:a("Error"),text:a("Error deleting {0}",[a(e.doctype)]),icon:"alert-circle",position:"bottom-center",iconClasses:"text-red-500"}),console.log(`Error deleting ${e.doctype}`)}}}),re=P({url:"frappe.client.get_doc_permissions",params:{doctype:e.doctype,docname:e.id}}),ie=P({url:"hrms.api.get_permitted_fields_for_write",params:{doctype:e.doctype}}),W=z(()=>{if(e.showFormButton){if(e.id&&e.isSubmittable&&!q.value){if(r.value.docstatus===0&&Q("submit"))return"Submit";if(r.value.docstatus===1&&Q("cancel"))return"Cancel"}else if(r.value.docstatus!==2)return"Save"}});function Ee(){return e.id&&r.value.docstatus!==1&&Q("delete")}function Q(o){var t;return(t=re.data)==null?void 0:t.permissions[o]}function de(o){var t;return!!o.read_only||Z.value||e.id&&!((t=ie.data)!=null&&t.includes(o.fieldname))}function $e(){ue()&&K.insert.submit(r.value)}function ue(){const o=e.fields.filter(t=>t.reqd&&!t.hidden&&!r.value[t.fieldname]).map(t=>t.label);return o.length?(D.value=`${o.join(", ")} ${o.length>1?"fields are mandatory":"field is mandatory"}`,!1):(D.value="",!0)}function X(o){return _(this,null,function*(){if(b.doc){let t=G({},r.value);if(!ue())return;o=="submit"?t.docstatus=1:o=="cancel"&&(t.docstatus=2),yield b.setValue.submit(t),yield b.get.promise,me()}o==="submit"?B.value=!1:o==="cancel"&&(E.value=!1)})}function Re(){p("validateForm"),e.id?X():$e()}function qe(){q.value||(r.value.docstatus===0?(p("validateForm"),B.value=!0):r.value.docstatus===1&&(E.value=!0))}function Ae(){b.delete.submit(),C.value=!1}function ce(){return _(this,null,function*(){yield b.reload(),me()})}function me(){r.value=G({},b.doc),Xe(()=>{q.value=!1,H.value=!0})}function Ue(){return _(this,null,function*(){const o=yield tt(r.value.company);e.fields.forEach(t=>{t.fieldtype==="Currency"&&(t.readOnly||Z.value)&&(t.options==="currency"?r.value[t.fieldname]=De(r.value[t.fieldname],r.value.currency):r.value[t.fieldname]=De(r.value[t.fieldname],o))})})}const Z=z(()=>{var o;if(!ee.value)return!0;if(!e.id)return!1;if(r.value.docstatus!==0||(o=A.value)!=null&&o.isReadOnly(r.value))return!0}),ee=z(()=>e.id?!b.get.loading&&b.doc:!0);return Me(()=>_(this,null,function*(){e.id&&(yield b.get.promise,r.value=G({},b.doc),yield re.reload(),yield ie.reload(),yield ae.reload(),yield Ue(),A.value=Ze(e.doctype),q.value=!1)})),(o,t)=>{var $,U,N,L,pe,ye,ve,ge;const x=Te("Button");return d(),y(O,null,[ee.value?(d(),y("div",ot,[c("div",st,[c("header",nt,[v(x,{variant:"ghost",class:"!pl-0 hover:bg-white",onClick:t[0]||(t[0]=s=>l(h).back())},{default:g(()=>[v(l(Ye),{name:"chevron-left",class:"h-5 w-5"})]),_:1}),i.id?(d(),y("div",rt,[c("h2",it,m(l(a)(e.doctype)),1),v(l(xe),{label:i.id,class:"whitespace-nowrap text-[8px]",variant:"outline"},null,8,["label"]),T.value?(d(),I(l(xe),{key:0,label:l(a)(T.value,null,i.doctype),theme:l(w),class:"whitespace-nowrap text-[8px]"},null,8,["label","theme"])):j("",!0),v(l(Ge),{class:"ml-auto",options:[{label:l(a)("Delete"),condition:Ee,onClick:()=>S(C)?C.value=!0:C=!0},{label:l(a)("Reload"),onClick:()=>ce()}],button:{label:l(a)("Menu"),icon:"more-horizontal",variant:"ghost"}},null,8,["options","button"])])):(d(),y("h2",dt,m(l(a)("New {0}",[l(a)(i.doctype)],e.doctype)),1))]),c("div",ut,[i.tabbedView?(d(),y(O,{key:0},[c("div",ct,[c("ul",mt,[(d(!0),y(O,null,J(i.tabs,s=>(d(),y("li",ft,[c("button",{onClick:Y=>S(F)?F.value=s.name:F=s.name,class:ke(["inline-block py-4 px-2 border-b-2 border-transparent rounded-t-lg",[l(F)===s.name?"!text-gray-800 !border-gray-800":"hover:text-gray-600 hover:border-gray-300"]])},m(l(a)(s.name,null,e.doctype)),11,pt)]))),256))])]),(d(!0),y(O,null,J(Be.value,(s,Y,Le)=>Je((d(),y("div",yt,[(d(!0),y(O,null,J(s,u=>(d(),y(O,{key:u.fieldname},[u.fieldtype=="Table"?_e(o.$slots,u.fieldname,{key:0,isFormReadOnly:Z.value}):(d(),I(Ce,{key:1,fieldtype:u.fieldtype,fieldname:u.fieldname,modelValue:r.value[u.fieldname],"onUpdate:modelValue":Oe=>r.value[u.fieldname]=Oe,default:u.default,label:l(a)(u.label,null,e.doctype),options:u.options,linkFilters:u.linkFilters,documentList:u.documentList,readOnly:de(u),reqd:!!u.reqd,hidden:!!u.hidden,errorMessage:u.error_message,minDate:u.minDate,maxDate:u.maxDate,addSectionPadding:s[0].name!==u.name},null,8,["fieldtype","fieldname","modelValue","onUpdate:modelValue","default","label","options","linkFilters","documentList","readOnly","reqd","hidden","errorMessage","minDate","maxDate","addSectionPadding"]))],64))),128)),l(M)?(d(),y("div",vt,[v(l(Fe),{class:"w-3 h-3 text-gray-800"}),c("span",gt,m(l(a)("Uploading...")),1)])):i.showAttachmentView&&Le===0?(d(),I(Ve,{key:1,modelValue:l(f),"onUpdate:modelValue":t[1]||(t[1]=u=>S(f)?f.value=u:f=u),onHandleFileSelect:oe,onHandleFileDelete:se},null,8,["modelValue"])):j("",!0)],512)),[[Ke,Y===l(F)]])),256))],64)):(d(),y("div",wt,[(d(!0),y(O,null,J(e.fields,s=>(d(),I(Ce,{key:s.name,fieldtype:s.fieldtype,fieldname:s.fieldname,modelValue:r.value[s.fieldname],"onUpdate:modelValue":Y=>r.value[s.fieldname]=Y,default:s.default,label:l(a)(s.label,null,e.doctype),options:s.options,linkFilters:s.linkFilters,documentList:s.documentList,readOnly:de(s),reqd:!!s.reqd,hidden:!!s.hidden,errorMessage:s.error_message,minDate:s.minDate,maxDate:s.maxDate},null,8,["fieldtype","fieldname","modelValue","onUpdate:modelValue","default","label","options","linkFilters","documentList","readOnly","reqd","hidden","errorMessage","minDate","maxDate"]))),128)),l(M)?(d(),y("div",ht,[v(l(Fe),{class:"w-3 h-3 text-gray-800"}),c("span",bt,m(l(a)("Uploading...")),1)])):i.showAttachmentView?(d(),I(Ve,{key:1,modelValue:l(f),"onUpdate:modelValue":t[2]||(t[2]=s=>S(f)?f.value=s:f=s),onHandleFileSelect:oe,onHandleFileDelete:se},null,8,["modelValue"])):j("",!0)]))]),i.showFormButton?!l(q)&&(($=l(A))!=null&&$.hasWorkflow)?(d(),I(et,{key:1,doc:l(b).doc,workflow:l(A),onWorkflowApplied:t[3]||(t[3]=s=>ce())},null,8,["doc","workflow"])):l(q)||!((U=l(A))!=null&&U.hasWorkflow)&&W.value?(d(),y("div",kt,[v(l(Qe),{class:"mb-2",message:l(D)||((L=(N=l(K))==null?void 0:N.insert)==null?void 0:L.error)||((ye=(pe=l(b))==null?void 0:pe.setValue)==null?void 0:ye.error)},null,8,["message"]),v(x,{class:ke(["w-full rounded py-5 text-base disabled:bg-gray-700 disabled:text-white",W.value==="Cancel"?"shadow":""]),onClick:t[4]||(t[4]=s=>W.value==="Save"?Re():qe()),variant:W.value==="Cancel"?"subtle":"solid",loading:l(K).insert.loading||((ge=(ve=l(b))==null?void 0:ve.setValue)==null?void 0:ge.loading)},{default:g(()=>[k(m(l(a)(W.value)),1)]),_:1},8,["class","variant","loading"])])):j("",!0):(d(),y("div",xt,[_e(o.$slots,"formButton")]))])])):j("",!0),v(l(te),{modelValue:l(C),"onUpdate:modelValue":t[6]||(t[6]=s=>S(C)?C.value=s:C=s)},{"body-title":g(()=>[c("h2",_t,m(l(a)("Delete {0}",[l(a)(e.doctype)])),1)]),"body-content":g(()=>[c("p",null,[k(m(l(a)("Are you sure you want to delete the {0}",[l(a)(e.doctype)]))+" ",1),c("span",Ft,m(r.value.name),1),t[13]||(t[13]=k(" ? "))])]),actions:g(()=>[c("div",Ct,[v(x,{variant:"outline",class:"py-5 w-full",onClick:t[5]||(t[5]=s=>S(C)?C.value=!1:C=!1)},{default:g(()=>[k(m(l(a)("Cancel")),1)]),_:1}),v(x,{variant:"solid",theme:"red",onClick:Ae,class:"py-5 w-full"},{default:g(()=>[k(m(l(a)("Delete")),1)]),_:1})])]),_:1},8,["modelValue"]),v(l(te),{modelValue:l(B),"onUpdate:modelValue":t[9]||(t[9]=s=>S(B)?B.value=s:B=s)},{"body-title":g(()=>[c("h2",Vt,m(l(a)("Confirm")),1)]),"body-content":g(()=>[c("p",null,[k(m(l(a)("Permanently submit {0}",[l(a)(e.doctype)]))+" ",1),c("span",Dt,m(r.value.name),1),t[14]||(t[14]=k(" ? "))])]),actions:g(()=>[c("div",St,[v(x,{variant:"outline",class:"py-5 w-full",onClick:t[7]||(t[7]=s=>S(B)?B.value=!1:B=!1)},{default:g(()=>[k(m(l(a)("No")),1)]),_:1}),v(x,{variant:"solid",onClick:t[8]||(t[8]=s=>X("submit")),class:"py-5 w-full"},{default:g(()=>[k(m(l(a)("Yes")),1)]),_:1})])]),_:1},8,["modelValue"]),v(l(te),{modelValue:l(E),"onUpdate:modelValue":t[12]||(t[12]=s=>S(E)?E.value=s:E=s)},{"body-title":g(()=>[c("h2",Bt,m(l(a)("Confirm")),1)]),"body-content":g(()=>[c("p",null,[k(m(l(a)("Permanently cancel {0}",[l(a)(e.doctype)]))+" ",1),c("span",Et,m(r.value.name),1),t[15]||(t[15]=k("? "))])]),actions:g(()=>[c("div",$t,[v(x,{variant:"outline",class:"py-5 w-full",onClick:t[10]||(t[10]=s=>S(E)?E.value=!1:E=!1)},{default:g(()=>[k(m(l(a)("No")),1)]),_:1}),v(x,{variant:"solid",onClick:t[11]||(t[11]=s=>X("cancel")),class:"py-5 w-full"},{default:g(()=>[k(m(l(a)("Yes")),1)]),_:1})])]),_:1},8,["modelValue"])],64)}}};export{It as default};
//# sourceMappingURL=FormView-B2Uh12No.js.map
