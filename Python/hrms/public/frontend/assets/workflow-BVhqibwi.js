var h=(i,e,s)=>new Promise((w,f)=>{var c=d=>{try{v(s.next(d))}catch(o){f(o)}},u=d=>{try{v(s.throw(d))}catch(o){f(o)}},v=d=>d.done?w(d.value):Promise.resolve(d.value).then(c,u);v((s=s.apply(i,e)).next())});import{N as b,E as z,c as S,a2 as D,f as y,j as k,k as m,l as p,q as r,n as j,t as x,x as E,F as O,r as B,i as M,a as P,e as N,a3 as U,I as q,z as F,v as R,H as V,ah as H,ac as T}from"./frappe-ui-Cee7Yz-T.js";import{d as G,f as J,g as K,h as Q,m as L,i as X,a as Y,j as Z,u as A}from"./index-67wm3rxu.js";const I=b({url:"hrms.api.get_company_currencies",auto:!0}),W=b({url:"hrms.api.get_currency_symbols",auto:!0});function ue(i){var e,s;return(s=(e=I==null?void 0:I.data)==null?void 0:e[i])==null?void 0:s[0]}function fe(i){var e;return(e=W==null?void 0:W.data)==null?void 0:e[i]}const ee={class:"bg-white h-full w-full overflow-auto touch-pinch-zoom"},te=["src"],oe=["src"],ae={__name:"FilePreviewModal",props:{file:{type:Object,required:!0}},setup(i){const e=i,s=S(()=>e.file.file_name||e.file.name),w=S(()=>e.file.file_url?e.file.file_url:URL.createObjectURL(e.file)),f=S(()=>/\.(gif|jpg|jpeg|tiff|png|svg)$/i.test(s.value));return D(()=>{URL.revokeObjectURL(w.value)}),(c,u)=>(k(),y(O,null,[m(r(X),null,{default:p(()=>[m(r(G),null,{default:p(()=>[m(r(J),null,{default:p(()=>[j(x(s.value)+" - "+x(c.__("File Preview")),1)]),_:1}),m(r(K),{slot:"end"},{default:p(()=>[m(r(Q),{onClick:u[0]||(u[0]=v=>r(L).dismiss())},{default:p(()=>[j(x(c.__("Close")),1)]),_:1})]),_:1})]),_:1})]),_:1}),m(r(Y),null,{default:p(()=>[E("div",ee,[f.value?(k(),y("img",{key:0,src:w.value,class:"h-auto image-preview"},null,8,te)):(k(),y("iframe",{key:1,src:w.value,class:"w-full h-full"},null,8,oe))])]),_:1})],64))}},se=z(ae,[["__scopeId","data-v-543e6e48"]]),de=Object.freeze(Object.defineProperty({__proto__:null,default:se},Symbol.toStringTag,{value:"Module"})),le={__name:"WorkflowActionSheet",props:{doc:{type:Object,required:!0},workflow:{type:Object,required:!1},view:{type:String,default:"form",validator:i=>["form","actionSheet"].includes(i)}},emits:["workflow-applied"],setup(i,{emit:e}){const s=i,w=e;let f=B(!1),c=B([]);const u=M("$translate"),v=()=>h(this,null,function*(){const t=yield s.workflow.getTransitions(s.doc);c.value=t.map(l=>{var $;let _="",a="gray",n="subtle",g="",C=l.toLowerCase();return C.includes("reject")||C.includes("cancel")?(_="destructive",a="red",n="subtle",g="x"):C.includes("approve")&&(a="green",n="solid",g="check"),{text:u(l,null,($=s.doc)==null?void 0:$.doctype),role:_,theme:a,variant:n,featherIcon:g,data:{action:l}}})}),d=()=>{var t;((t=c.value)==null?void 0:t.length)>0&&c.value.push({text:u("Dismiss"),role:"cancel"}),f.value=!0},o=_=>h(this,[_],function*({event:t="",workflowAction:l=""}){var n;const a=l||((n=t.detail.data)==null?void 0:n.action);a&&(yield s.workflow.applyWorkflow(s.doc,a),L.dismiss(),w("workflow-applied")),f.value=!1});return P(()=>v()),(t,l)=>{const _=N("Button");return k(),y(O,null,[r(c).length>0?(k(),y("div",{key:0,class:q([s.view==="form"?"px-4 pt-4 pb-4 standalone:pb-safe-bottom sm:w-96 bg-white sticky bottom-0 w-full drop-shadow-xl z-40 border-t rounded-t-lg":"flex w-full flex-row items-center justify-between gap-3 sticky bottom-0 border-t z-[100] p-4"])},[s.view==="form"||r(c).length>2?(k(),F(_,{key:0,onClick:l[0]||(l[0]=a=>d()),class:"w-full rounded py-5 text-base disabled:bg-gray-700 disabled:text-white",variant:"solid"},{prefix:p(()=>[m(r(R),{name:"chevron-up",class:"w-4"})]),default:p(()=>[j(" "+x(r(u)("Actions")),1)]),_:1})):(k(!0),y(O,{key:1},V(r(c),a=>(k(),F(_,{class:"w-full py-5",variant:a.variant,theme:a.theme,onClick:n=>o({workflowAction:a.text})},H({default:p(()=>{var n;return[j(" "+x(r(u)(a.text,null,(n=s.doc)==null?void 0:n.doctype)),1)]}),_:2},[a.featherIcon?{name:"prefix",fn:p(()=>[m(r(R),{name:a.featherIcon,class:"w-4"},null,8,["name"])]),key:"0"}:void 0]),1032,["variant","theme","onClick"]))),256))],2)):U("",!0),m(r(Z),{buttons:r(c),"is-open":r(f),onDidDismiss:l[1]||(l[1]=a=>o({event:a}))},null,8,["buttons","is-open"])],64)}}},re=z(le,[["__scopeId","data-v-d639c66c"]]),pe=Object.freeze(Object.defineProperty({__proto__:null,default:re},Symbol.toStringTag,{value:"Module"}));function we(i){const e=b({url:"hrms.api.get_workflow",params:{doctype:i},cache:["hrms:workflow",i]});e.reload();const s=S(()=>{const o=e==null?void 0:e.data;return Object.keys(o||{}).length>0}),w=()=>{var o,t;return(o=e.data)!=null&&o.override_status?"":(t=e.data)==null?void 0:t.workflow_state_field},f=o=>{var t;return(t=e.data)==null?void 0:t.states.find(l=>l.doc_status==o)},c=o=>h(this,null,function*(){return yield b({url:"frappe.model.workflow.get_transitions",params:{doc:o},transform:l=>{var a,n;const _=((n=(a=A)==null?void 0:a.data)==null?void 0:n.name)==o.owner;return l.filter(g=>g.allow_self_approval||!_).map(g=>g.action)}}).reload()}),u=o=>{var t;return(t=e.data)==null?void 0:t.states.filter(l=>l.state==o).map(l=>l.allow_edit)};return{hasWorkflow:s,workflowDoc:e,getWorkflowStateField:w,getTransitions:c,getDocumentStateRoles:u,isReadOnly:o=>{var a;const t=(a=e.data)==null?void 0:a.workflow_state_field;if(!t)return!1;const l=o[t]||f(o.docstatus);return!u(l).some(n=>A.data.roles.includes(n))},applyWorkflow:(o,t)=>h(this,null,function*(){yield b({url:"frappe.model.workflow.apply_workflow",params:{doc:o,action:t},onSuccess(){T({title:"Success",text:`Workflow action '${t}' applied successfully`,icon:"check-circle",position:"bottom-center",iconClasses:"text-green-500"})},onError(){T({title:"Error",text:`Error applying workflow action: ${t}`,icon:"alert-circle",position:"bottom-center",iconClasses:"text-red-500"}),console.log(`Error applying workflow action: ${t}`)}}).reload()})}}export{se as F,re as W,fe as a,de as b,pe as c,ue as g,we as u};
//# sourceMappingURL=workflow-BVhqibwi.js.map
