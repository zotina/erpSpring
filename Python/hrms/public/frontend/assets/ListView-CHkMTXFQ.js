var fe=Object.defineProperty,pe=Object.defineProperties;var ve=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var W=(a,l,t)=>l in a?fe(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,J=(a,l)=>{for(var t in l||(l={}))ye.call(l,t)&&W(a,t,l[t]);if(K)for(var t of K(l))ge.call(l,t)&&W(a,t,l[t]);return a},Y=(a,l)=>pe(a,ve(l));var N=(a,l,t)=>new Promise((B,F)=>{var D=u=>{try{R(t.next(u))}catch(c){F(c)}},L=u=>{try{R(t.throw(u))}catch(c){F(c)}},R=u=>u.done?B(u.value):Promise.resolve(u.value).then(D,L);R((t=t.apply(a,l)).next())});import{i as I,a0 as h,a9 as _e,O as we,r as y,c as T,N as G,w as he,a as ke,e as P,f as S,j as i,k as r,l as f,x as k,q as s,v as Q,t as X,z as x,a3 as A,I as be,n as Ce,ai as xe,F as Z,H as Fe,J as ee,ab as Re}from"./frappe-ui-Cee7Yz-T.js";import{i as $e,M as Se,N as Be,a as Ee,c as qe,m as te}from"./index-67wm3rxu.js";import Ve from"./TabButtons-BSa_JXcY.js";import Ne from"./EmployeeCheckinItem-Cac0XolZ.js";import Ie from"./AttendanceRequestItem-BN8PO8eN.js";import Te from"./ShiftRequestItem-D3XJomKo.js";import Ae from"./ShiftAssignmentItem-BaUJy9HP.js";import De from"./LeaveRequestItem-B5H55-ms.js";import Le from"./ExpenseClaimItem-C_e5ZGf0.js";import je from"./EmployeeAdvanceItem-DbQMpTUv.js";import Me from"./ListFiltersActionSheet-Q-bL_Evk.js";import He from"./CustomIonModal-D0aHGeN-.js";import{R as Oe,b as Pe}from"./requestSummaryFields-du6TJ0Je.js";import{u as Ue}from"./workflow-BVhqibwi.js";import{u as ze}from"./realtime-BHE_6RdY.js";import"./ListItem-PeN0voCp.js";import"./EmployeeAvatar-DoNux1Vg.js";import"./formatters-Ephtd2vf.js";import"./attendance-BRvU06nR.js";import"./ShiftIcon-ByQyaDbK.js";import"./leaves-CYSs7oDG.js";import"./EmployeeAdvanceIcon-DDAk-iZl.js";import"./FormField-CAm_QixC.js";import"./Link-PW9qmcCL.js";import"./FormattedField-CUhRRhqS.js";const Ke={class:"w-full sm:w-96"},We={class:"flex flex-row bg-white shadow-sm py-4 px-3 items-center justify-between border-b"},Je={class:"flex flex-row items-center"},Ye={class:"text-xl font-semibold text-gray-900"},Ge={class:"flex flex-row gap-2"},Qe={class:"w-full"},Xe={key:1,class:"flex flex-col bg-white rounded mt-5"},Ze={key:3,class:"flex mt-2 items-center justify-center"},Rt={__name:"ListView",props:{doctype:{type:String,required:!0},fields:{type:Array,required:!0},groupBy:{type:String,required:!1},filterConfig:{type:Array,required:!0},tabButtons:{type:Array,required:!1},pageTitle:{type:String,required:!0}},setup(a){const l=I("$translate"),t=a,B=e=>{var o;return(o=e==null?void 0:e.key)!=null?o:e},F={"Employee Checkin":h(Ne),"Attendance Request":h(Ie),"Shift Request":h(Te),"Shift Assignment":h(Ae),"Leave Application":h(De),"Expense Claim":h(Le),"Employee Advance":h(je)},D=_e(),L=I("$dayjs"),R=I("$socket"),u=I("$employee"),c=we({}),E=y(t.tabButtons?B(t.tabButtons[0]):void 0),j=y(!1),b=y([]),$=y(null),M=y(!1),p=y(null),U=y(null),H=y(!0),q=y({doctype:t.doctype,fields:t.fields,group_by:t.groupBy,order_by:`\`tab${t.doctype}\`.modified desc`,page_length:50}),O=T(()=>t.tabButtons&&E.value===B(t.tabButtons[1])),oe=T(()=>`${t.doctype.replace(/\s+/g,"")}FormView`),se=T(()=>`${t.doctype.replace(/\s+/g,"")}DetailView`),ae=T(()=>{const e=[];return O.value?e.push([t.doctype,"employee","!=",u.data.name]):e.push([t.doctype,"employee","=",u.data.name]),e}),d=G({url:"frappe.desk.reportview.get",onSuccess:e=>{var o;((o=e.values)==null?void 0:o.length)<q.value.page_length&&(H.value=!1)},transform(e){if(e.length===0)return[];const o=e.keys,C=e.values.map(v=>{const g={};return o.forEach((n,V)=>{g[n]=v[V]}),g});let w;return!d.params.start||d.params.start===0?w=C:w=d.data.concat(C),w}}),le=G({url:"frappe.client.has_permission",params:{doctype:t.doctype,docname:null,perm_type:"create"},auto:!0}),ne=e=>N(this,null,function*(){p.value=e,p.value.doctype="Employee Checkin",p.value.date=e.time,p.value.formatted_time=L(e.time).format("HH:mm a"),p.value.formatted_latitude=`${Number(e.latitude).toFixed(5)}°`,p.value.formatted_longitude=`${Number(e.longitude).toFixed(5)}°`,M.value=!0}),re=()=>N(this,null,function*(){M.value=!1,p.value=null});function z(){t.filterConfig.forEach(e=>{c[e.fieldname]={condition:"=",value:null}}),b.value=[]}z();function ie(){let e="",o="";b.value=[];for(const m in c)e=c[m].condition,typeof e=="object"&&e!==null&&(e=e.value),o=c[m].value,e&&o&&b.value.push([t.doctype,m,e,o])}function ue(){ie(),_(),te.dismiss(),j.value=!!b.value.length}function ce(){z(),_(),te.dismiss(),j.value=!1}function _(e=0){e===0&&(H.value=!0);const o=[[t.doctype,"docstatus","!=","2"]];o.push(...ae.value),b.value&&o.push(...b.value),$.value&&q.value.fields.push($.value),d.submit(Y(J({},q.value),{start:e||0,filters:o}))}const de=xe(()=>{if(!H.value)return;const{scrollTop:e,scrollHeight:o,clientHeight:m}=U.value;if(e/(o-m)*100>=90){const w=d.params.start+q.value.page_length;_(w)}},500),me=e=>{setTimeout(()=>{_(),e.target.complete()},500)};return he(()=>E.value,e=>{_()}),ke(()=>N(this,null,function*(){const e=Ue(t.doctype);yield e.workflowDoc.promise,$.value=e.getWorkflowStateField(),_(),ze(R,t.doctype,()=>_())})),(e,o)=>{const m=P("Button"),C=P("router-link"),w=P("EmptyState");return i(),S(Z,null,[r(s($e),{class:"ion-no-border"},{default:f(()=>{var v,g;return[k("div",Ke,[k("div",We,[k("div",Je,[r(m,{variant:"ghost",class:"!px-1 mr-1 hover:bg-white",onClick:o[0]||(o[0]=n=>s(D).back())},{default:f(()=>[r(s(Q),{name:"chevron-left",class:"h-5 w-5"})]),_:1}),k("h2",Ye,X(a.pageTitle),1)]),k("div",Ge,[r(m,{id:"show-filter-modal",icon:"filter",variant:"subtle",class:be([j.value?"!border !border-gray-800 !bg-white !text-gray-900 !font-semibold":""])},null,8,["class"]),(g=(v=s(le))==null?void 0:v.data)!=null&&g.has_permission&&t.doctype!="Employee Checkin"?(i(),x(C,{key:0,to:{name:oe.value}},{default:f(({navigate:n})=>[r(m,{variant:"solid",class:"mr-2",onClick:n},{prefix:f(()=>[r(s(Q),{name:"plus",class:"w-4"})]),default:f(()=>[Ce(" "+X(s(l)("New",null,t.doctype)),1)]),_:2},1032,["onClick"])]),_:1},8,["to"])):A("",!0)])])])]}),_:1}),r(s(Ee),null,{default:f(()=>{var v,g;return[r(s(Se),{slot:"fixed",onIonRefresh:o[1]||(o[1]=n=>me(n))},{default:f(()=>[r(s(Be))]),_:1}),k("div",{class:"flex flex-col items-center mb-7 p-4 h-full w-full sm:w-96 overflow-y-auto",ref_key:"scrollContainer",ref:U,onScroll:o[3]||(o[3]=()=>s(de)())},[k("div",Qe,[t.tabButtons?(i(),x(Ve,{key:0,class:"mt-5",buttons:t.tabButtons,modelValue:E.value,"onUpdate:modelValue":o[2]||(o[2]=n=>E.value=n)},null,8,["buttons","modelValue"])):A("",!0),!s(d).loading&&((v=s(d).data)!=null&&v.length)?(i(),S("div",Xe,[(i(!0),S(Z,null,Fe(s(d).data,n=>(i(),S("div",{class:"p-3.5 items-center justify-between border-b cursor-pointer",key:n.name},[t.doctype==="Employee Checkin"?(i(),x(ee(F[a.doctype]),{key:0,doc:n,isTeamRequest:O.value,workflowStateField:$.value,onClick:V=>ne(n)},null,8,["doc","isTeamRequest","workflowStateField","onClick"])):(i(),x(C,{key:1,to:{name:se.value,params:{id:n.name}}},{default:f(({navigate:V})=>[(i(),x(ee(F[a.doctype]),{doc:n,isTeamRequest:O.value,workflowStateField:$.value,onClick:V},null,8,["doc","isTeamRequest","workflowStateField","onClick"]))]),_:2},1032,["to"]))]))),128))])):s(d).loading?A("",!0):(i(),x(w,{key:2,message:s(l)("No {0} found",[(g=t.doctype)==null?void 0:g.toLowerCase()])},null,8,["message"])),s(d).loading?(i(),S("div",Ze,[r(s(Re),{class:"w-8 h-8 text-gray-800"})])):A("",!0)])],544),r(He,{trigger:"show-filter-modal"},{actionSheet:f(()=>[r(Me,{filterConfig:a.filterConfig,onApplyFilters:ue,onClearFilters:ce,filters:c,"onUpdate:filters":o[4]||(o[4]=n=>c=n)},null,8,["filterConfig","filters"])]),_:1})]}),_:1}),r(s(qe),{ref:"modal","is-open":M.value,onDidDismiss:re,"initial-breakpoint":1,breakpoints:[0,1]},{default:f(()=>[r(Oe,{fields:s(Pe),showOpenForm:!1,modelValue:p.value,"onUpdate:modelValue":o[5]||(o[5]=v=>p.value=v)},null,8,["fields","modelValue"])]),_:1},8,["is-open"])],64)}}};export{Rt as default};
//# sourceMappingURL=ListView-CHkMTXFQ.js.map
